# 《基于 Vue3 的跨平台前端框架》

![案例](https://p4.ssl.qhimg.com/t110b9a930112ca272bafc061bf.gif)

## 一、引言

前些日子运营需要搭建一个既能兼容pc端又能兼容移动端的框架，方便扫码购买AI会员课程，老周也在讲课的时候用这个码来买课，但是找遍互联网，能同时做到移动/pc兼容,又适用在企业级框架的几乎没有，索性自己工作之余，搭建了一个

本框架既兼容pc又兼容移动端的企业级框架。整合了一系列前沿且高效的技术栈，旨在既满足企业需求又提供了优化方案，满足多样化的业务需求和交互场景。

## 二、技术架构核心组件

### （一）Vue3

作为当下最热门的 JavaScript 框架之一，Vue3 带来了众多显著的改进和创新特性，如更高效的响应式系统、Composition API 等。其灵活的组件化开发模式使得代码的复用性和可维护性得到极大提升。

### （二）Vite

Vite 是一种新型的前端构建工具，它利用 ES 模块的特性实现了极速的冷启动和热模块替换（HMR）。在开发过程中，显著缩短了代码编译和更新的时间，极大地提高了开发效率。其简洁的配置和高效的打包策略，无论是在开发阶段的快速迭代还是在生产环境的代码优化，都表现出色。

### （三）Vant

Vant 是一个轻量级、高性能的移动端组件库，涵盖了丰富多样的 UI 组件，如按钮、表单、列表、弹窗等，能够满足移动端各种常见的交互设计需求。其简洁美观的样式和良好的交互体验，遵循移动端设计规范，确保在移动设备上呈现出专业且一致的视觉效果，同时也具备良好的兼容性和性能表现。

### （四）Pinia

Pinia 是 Vue 的状态管理库，它提供了一种简洁、直观且强大的方式来管理应用程序的状态。相较于传统的状态管理模式，Pinia 具有更好的类型推导支持、更方便的模块组织方式以及灵活的插件扩展机制，使得状态的管理和共享变得更加高效和易于维护，在处理复杂的应用状态逻辑时表现出色，是构建大型应用不可或缺的一环。

### （五）TypeScript

TypeScript 为 JavaScript 带来了强大的静态类型检查系统，增强了代码的可读性、可维护性和稳定性。在大型项目中，能够提前发现类型相关的错误，减少运行时错误的出现概率，提高代码的质量和可扩展性。通过类型定义，使得代码的结构更加清晰。

## 三、开发环境优化与工具配置

### （一）Node 版本管理

鉴于本框架所依赖的技术栈对 Node 版本有一定要求，建议使用 Node 版本大于 14.18。在本地存在多个 Node 版本的情况下，推荐使用 `nvm`（Node Version Manager）进行版本切换，确保开发环境的稳定性和一致性。`nvm` 能够方便地在不同 Node 版本之间进行切换，满足不同项目的特定需求，避免因 Node 版本问题导致的兼容性错误和依赖安装失败等问题。

### （二）VSCode 插件推荐

针对 Vue3 项目开发，应避免使用 `Vetur` 插件，因其对 Vue3 诸多特性的支持不够完善，可能会出现大量红线警告，影响开发体验和代码质量判断。相反，建议使用 `Vue Language Features` 和 `TypeScript Vue Plugin` 这两个插件。`Vue Language Features` 提供了全面的 Vue 语法支持、智能提示和代码导航功能，能够更好地理解和编写 Vue3 代码；`TypeScript Vue Plugin` 则进一步增强了 TypeScript 在 Vue 项目中的类型推导和代码检查能力。

## 四、开发流程与命令

### （一）本地开发

```bash
npm install

npm run dev
```

### （二）打包构建

1. **测试包构建**：执行 `npm run build:test`。
2. **正式包构建**：运行 `npm run build`。

## 五、关键技术实现与优化策略

### （一）响应式布局与适配

1. PostCSS 插件配置
   - **`autoprefixer`**：自动为 CSS 属性添加浏览器前缀，确保在不同浏览器上的兼容性。它会根据 `Can I Use` 数据库中的信息，智能地为需要前缀的 CSS 属性添加相应的浏览器前缀，如 `-webkit-`、`-moz-` 等，使得编写的 CSS 代码能够在各种主流浏览器上正确显示，避免了因浏览器兼容性问题导致的样式异常，减少了开发者在处理浏览器前缀方面的工作量。
   - **`px2viewport`**：本框架针对 Vant 组件库和非 Vant 部分分别进行了 `px` 到 `vw` 的转换配置。对于 Vant 组件，通过设置特定的 `viewportWidth`（如 `375`）和 `exclude` 规则，确保在将 `px` 单位转换为 `vw` 时，能够精准适配移动端屏幕，同时避免对 Vant 组件内部样式的不必要转换，保证组件的正常显示和交互效果。对于非 Vant 部分的样式，同样采用 `px2viewport` 转换，实现整体页面的响应式布局，使得页面元素能够根据屏幕宽度自适应调整大小，提供一致的用户体验。
   - **`postcss-mobile-forever`**：在适配移动端的基础上，新增了对 PC 端的适配策略。通过设置 `viewportWidth` 和 `maxDisplayWidth`，确保页面在 PC 端显示时，最大宽度不会超过指定值（如 `600px` 与 `viewportWidth` 的 `min` 值），同时结合 `border` 和 `rootContainingBlockSelectorList` 等参数，对特定元素（如 `van-popup`）进行了优化处理，保证在不同屏幕尺寸下，页面的布局和样式都能保持合理和美观，无论是在移动端的小屏幕还是 PC 端的大屏幕上，都能呈现出最佳的视觉效果。

### （二）性能优化与状态管理

1. **Vue-Lazyload**：用于实现图片的懒加载功能，在页面初始加载时，只有进入可视区域的图片才会被加载，大大减少了初始页面加载时的资源请求数量，提高了页面的加载速度。特别是在包含大量图片的页面中，能够显著提升用户体验，避免因过多图片同时加载导致的页面卡顿和长时间白屏现象。
2. **Vue-Router 封装**：对 Vue Router 进行了封装，优化了路由的配置和管理方式。通过合理的路由懒加载策略，将不同路由对应的组件进行按需加载，进一步减少了初始加载时的代码体积，提高了页面的切换速度和响应性能。同时，对路由的导航守卫、参数传递等方面进行了优化，使得路由的使用更加灵活和高效，方便开发者处理页面之间的跳转逻辑和数据传递。
3. **Pinia 状态管理**：如前所述，Pinia 在整个项目的状态管理中发挥了关键作用。它通过简洁的 API 和良好的组织方式，使得应用的状态能够被集中管理和高效更新。在处理复杂的业务逻辑时，如用户登录状态管理、数据缓存与同步等，Pinia 能够提供清晰的状态流向和易于维护的代码结构，避免了状态混乱和难以调试的问题，提高了整个应用的稳定性和可扩展性。

### （三）代码质量保障

1. **ESLint 和 Stylelint**：分别用于对 JavaScript 和 CSS/SCSS 代码进行静态代码检查和风格规范检查。ESLint 能够根据预定义的规则集（如 Airbnb 或 Standard 风格），检查代码中的语法错误、潜在的逻辑问题以及不符合规范的代码写法，如变量未定义、函数参数过多等问题，并提供自动修复建议，确保代码的质量和一致性。Stylelint 则专注于 CSS 代码的检查，包括语法错误、属性顺序、选择器规范等方面，保证 CSS 代码的规范性和可维护性，使得整个项目的代码风格统一。
2. **Lint-Staged 和 Githook**：`Lint-Staged` 与 `Githook`（如 `pre-commit` 钩子）相结合，实现了在代码提交前对暂存区的代码进行自动化检查和修复。当开发者执行 `git commit` 操作时，`pre-commit` 钩子会触发 `Lint-Staged`，它会对本次提交涉及的文件进行 ESLint 和 Stylelint 检查，并自动修复可修复的问题。如果存在无法自动修复的错误，提交操作将被阻止，开发者需要先修复这些问题才能成功提交代码，从而保证了提交到代码库中的代码始终符合质量标准，避免了低质量代码的积累。

### （四）移动端调试辅助

`VConsole`：在移动端开发中，`VConsole` 是一个强大的调试工具。它可以在手机端方便地查看日志信息，包括 JavaScript 中的 `console.log` 输出、网络请求信息、页面性能数据等。通过在代码中根据环境判断是否引入 `VConsole`，开发者可以在开发和测试阶段轻松地在手机上进行调试，快速定位和解决问题，而无需依赖复杂的桌面调试工具，提高了移动端开发的效率和便捷性。

## 六、总结与展望

本框架通过整合 Vue3、Vite、Vant、Pinia、TypeScript 等先进技术，结合一系列优化策略和工具配置，实现了一个高效、稳定且跨平台的前端开发解决方案。在未来的发展中，随着前端技术的不断演进，我们将持续关注并引入新的特性和优化方法，不断提升框架的性能、开发体验和用户体验，以满足日益增长的业务需求和技术挑战，为前端开发领域带来更多的创新和价值。

## 七、参考资料

- [Vite 官方文档](https://cn.vitejs.dev/)
- [Vant 官方文档](https://vant-ui.github.io/vant/#/zh-CN/quickstart)